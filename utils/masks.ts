
export const phoneMask = (value: string): string => {
    return value
        .replace(/\D/g, '')
        .replace(/(\d{2})(\d)/, '($1) $2')
        .replace(/(\d{5})(\d)/, '$1-$2')
        .substring(0, 15);
};

export const cnpjMask = (value: string): string => {
    return value
        .replace(/\D/g, '')
        .replace(/(\d{2})(\d)/, '$1.$2')
        .replace(/(\d{3})(\d)/, '$1.$2')
        .replace(/(\d{3})(\d)/, '$1/$2')
        .replace(/(\d{4})(\d)/, '$1-$2')
        .substring(0, 18);
};

export const cpdMask = (value: string): string => {
    return value.replace(/\D/g, '').substring(0, 10);
};

export const currencyMask = (value: string): string => {
    console.log('üîç currencyMask - Input:', value);
    
    if (!value || value.trim() === '') {
        console.log('üîç currencyMask - Empty value, returning empty');
        return '';
    }
    
    // Remover R$ e espa√ßos
    let cleanValue = value.replace(/[R$\s]/g, '');
    console.log('üîç currencyMask - Clean value:', cleanValue);
    
    // Se est√° vazio ap√≥s limpeza, retornar vazio
    if (cleanValue === '') {
        console.log('üîç currencyMask - Clean value is empty, returning empty');
        return '';
    }
    
    // Se tem v√≠rgula, significa que j√° est√° formatado
    if (cleanValue.includes(',')) {
        console.log('üîç currencyMask - Has comma, formatting existing value');
        // Limitar a 2 casas decimais ap√≥s a v√≠rgula
        let parts = cleanValue.split(',');
        if (parts[1] && parts[1].length > 2) {
            parts[1] = parts[1].substring(0, 2);
        }
        // Apenas reaplicar a formata√ß√£o de milhares
        parts[0] = parts[0].replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.');
        const result = `R$ ${parts.join(',')}`;
        console.log('üîç currencyMask - Formatted result:', result);
        return result;
    }
    
    // Se n√£o tem v√≠rgula, tratar como valor em reais (n√£o centavos)
    let v = cleanValue.replace(/\D/g, '');
    console.log('üîç currencyMask - Only numbers:', v);
    
    if (v === '') {
        console.log('üîç currencyMask - No numbers found, returning empty');
        return '';
    }
    
    const numValue = parseInt(v, 10);
    console.log('üîç currencyMask - Parsed number:', numValue);
    
    if (isNaN(numValue)) {
        console.log('üîç currencyMask - Invalid number, returning empty');
        return '';
    }
    
    // Tratar como valor em reais, n√£o centavos
    v = numValue.toString();
    v = v.replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.');
    const result = `R$ ${v},00`;
    console.log('üîç currencyMask - Final result:', result);
    return result;
};

// Nova fun√ß√£o para m√°scara autom√°tica como calculadora
export const currencyMaskAuto = (value: string): string => {
    console.log('üöÄ currencyMaskAuto - Input:', value);
    
    if (!value || value.trim() === '') {
        console.log('üöÄ currencyMaskAuto - Empty value, returning empty');
        return '';
    }
    
    // Remover R$ e espa√ßos
    let cleanValue = value.replace(/[R$\s]/g, '');
    console.log('üöÄ currencyMaskAuto - Clean value:', cleanValue);
    
    // Se est√° vazio ap√≥s limpeza, retornar vazio
    if (cleanValue === '') {
        console.log('üöÄ currencyMaskAuto - Clean value is empty, returning empty');
        return '';
    }
    
    // Se tem v√≠rgula, significa que j√° est√° formatado
    if (cleanValue.includes(',')) {
        console.log('üöÄ currencyMaskAuto - Has comma, formatting existing value');
        // Limitar a 2 casas decimais ap√≥s a v√≠rgula
        let parts = cleanValue.split(',');
        if (parts[1] && parts[1].length > 2) {
            parts[1] = parts[1].substring(0, 2);
        }
        // Apenas reaplicar a formata√ß√£o de milhares
        parts[0] = parts[0].replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.');
        const result = `R$ ${parts.join(',')}`;
        console.log('üöÄ currencyMaskAuto - Formatted result:', result);
        return result;
    }
    
    // Se n√£o tem v√≠rgula, tratar como valor em reais (n√£o centavos)
    let v = cleanValue.replace(/\D/g, '');
    console.log('üöÄ currencyMaskAuto - Only numbers:', v);
    
    if (v === '') {
        console.log('üöÄ currencyMaskAuto - No numbers found, returning empty');
        return '';
    }
    
    const numValue = parseInt(v, 10);
    console.log('üöÄ currencyMaskAuto - Parsed number:', numValue);
    
    if (isNaN(numValue)) {
        console.log('üöÄ currencyMaskAuto - Invalid number, returning empty');
        return '';
    }
    
    // Tratar como valor em reais, n√£o centavos
    v = numValue.toString();
    v = v.replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.');
    const result = `R$ ${v},00`;
    console.log('üöÄ currencyMaskAuto - Final result:', result);
    return result;
};

// Fun√ß√£o para m√°scara de moeda que funciona como calculadora real
export const currencyMaskCalculator = (value: string): string => {
    console.log('üßÆ currencyMaskCalculator - Input:', value);
    
    if (!value || value.trim() === '') {
        console.log('üßÆ currencyMaskCalculator - Empty value, returning empty');
        return '';
    }
    
    // Remover R$ e espa√ßos
    let cleanValue = value.replace(/[R$\s]/g, '');
    console.log('üßÆ currencyMaskCalculator - Clean value:', cleanValue);
    
    // Se est√° vazio ap√≥s limpeza, retornar vazio
    if (cleanValue === '') {
        console.log('üßÆ currencyMaskCalculator - Clean value is empty, returning empty');
        return '';
    }
    
    // Se tem v√≠rgula, significa que j√° est√° formatado
    if (cleanValue.includes(',')) {
        console.log('üßÆ currencyMaskCalculator - Has comma, formatting existing value');
        // Limitar a 2 casas decimais ap√≥s a v√≠rgula
        let parts = cleanValue.split(',');
        if (parts[1] && parts[1].length > 2) {
            parts[1] = parts[1].substring(0, 2);
        }
        // Apenas reaplicar a formata√ß√£o de milhares
        parts[0] = parts[0].replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.');
        const result = `R$ ${parts.join(',')}`;
        console.log('üßÆ currencyMaskCalculator - Formatted result:', result);
        return result;
    }
    
    // Se n√£o tem v√≠rgula, tratar como valor em reais (n√£o centavos)
    let v = cleanValue.replace(/\D/g, '');
    console.log('üßÆ currencyMaskCalculator - Only numbers:', v);
    
    if (v === '') {
        console.log('üßÆ currencyMaskCalculator - No numbers found, returning empty');
        return '';
    }
    
    const numValue = parseInt(v, 10);
    console.log('üßÆ currencyMaskCalculator - Parsed number:', numValue);
    
    if (isNaN(numValue)) {
        console.log('üßÆ currencyMaskCalculator - Invalid number, returning empty');
        return '';
    }
    
    // Tratar como valor em reais, n√£o centavos
    v = numValue.toString();
    v = v.replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.');
    const result = `R$ ${v},00`;
    console.log('üßÆ currencyMaskCalculator - Final result:', result);
    return result;
};

// Fun√ß√£o SIMPLES para m√°scara de moeda que SEMPRE funciona
export const currencyMaskSimple = (value: string): string => {
    console.log('‚ú® currencyMaskSimple - Input:', value);
    
    // Se est√° vazio, retornar vazio
    if (!value || value.trim() === '') {
        console.log('‚ú® currencyMaskSimple - Empty, returning empty');
        return '';
    }
    
    // Extrair apenas n√∫meros
    const numbers = value.replace(/\D/g, '');
    console.log('‚ú® currencyMaskSimple - Numbers only:', numbers);
    
    if (numbers === '') {
        console.log('‚ú® currencyMaskSimple - No numbers, returning empty');
        return '';
    }
    
    // Converter para n√∫mero
    const num = parseInt(numbers, 10);
    console.log('‚ú® currencyMaskSimple - Parsed number:', num);
    
    if (isNaN(num)) {
        console.log('‚ú® currencyMaskSimple - Invalid number, returning empty');
        return '';
    }
    
    // Formatar com pontos de milhares
    const formatted = num.toLocaleString('pt-BR');
    const result = `R$ ${formatted},00`;
    console.log('‚ú® currencyMaskSimple - Final result:', result);
    return result;
};

// Fun√ß√£o LIBRE para m√°scara de moeda - deixa o usu√°rio digitar livremente
export const currencyMaskFree = (value: string): string => {
    console.log('üÜì currencyMaskFree - Input:', value);
    
    // Se est√° vazio, retornar vazio
    if (!value || value.trim() === '') {
        console.log('üÜì currencyMaskFree - Empty, returning empty');
        return '';
    }
    
    // Se j√° tem R$, deixar como est√°
    if (value.startsWith('R$')) {
        console.log('üÜì currencyMaskFree - Already has R$, returning as is');
        return value;
    }
    
    // Se tem n√∫meros, adicionar R$ na frente
    const hasNumbers = /\d/.test(value);
    if (hasNumbers) {
        const result = `R$ ${value}`;
        console.log('üÜì currencyMaskFree - Added R$, result:', result);
        return result;
    }
    
    console.log('üÜì currencyMaskFree - No numbers, returning empty');
    return '';
};

// Nova fun√ß√£o para lidar com edi√ß√£o de moeda de forma mais inteligente
export const currencyMaskWithCursor = (value: string, cursorPosition: number): { value: string; cursorPosition: number } => {
    if (!value || value.trim() === '') return { value: '', cursorPosition: 0 };
    
    // Remover R$ e espa√ßos
    let cleanValue = value.replace(/[R$\s]/g, '');
    
    // Se est√° vazio ap√≥s limpeza, retornar vazio
    if (cleanValue === '') return { value: '', cursorPosition: 0 };
    
    // Se tem v√≠rgula, significa que j√° est√° formatado
    if (cleanValue.includes(',')) {
        // Apenas reaplicar a formata√ß√£o de milhares
        let parts = cleanValue.split(',');
        parts[0] = parts[0].replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.');
        const formatted = `R$ ${parts.join(',')}`;
        return { value: formatted, cursorPosition: formatted.length };
    }
    
    // Se n√£o tem v√≠rgula, tratar como valor inteiro (centavos)
    let v = cleanValue.replace(/\D/g, '');
    if (v === '') return { value: '', cursorPosition: 0 };
    
    const numValue = parseInt(v, 10);
    if (isNaN(numValue)) return { value: '', cursorPosition: 0 };
    
    // Converter centavos para reais e limitar a 2 casas decimais
    v = (numValue / 100).toFixed(2);
    v = v.replace(".", ",");
    v = v.replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.');
    const formatted = `R$ ${v}`;
    
    return { value: formatted, cursorPosition: formatted.length };
};

export const unmaskCurrency = (value: string): number => {
    console.log('üí∞ unmaskCurrency - Input:', value);
    
    if (!value || value.trim() === '') {
        console.log('üí∞ unmaskCurrency - Empty value, returning 0');
        return 0;
    }
    
    // Remover R$ e espa√ßos, manter apenas n√∫meros, v√≠rgulas e pontos
    let cleanValue = value.replace(/[R$\s]/g, '');
    console.log('üí∞ unmaskCurrency - Clean value:', cleanValue);
    
    // Se tem v√≠rgula, √© o separador decimal
    if (cleanValue.includes(',')) {
        // Remover pontos (separadores de milhares) e trocar v√≠rgula por ponto
        cleanValue = cleanValue.replace(/\./g, '').replace(',', '.');
        console.log('üí∞ unmaskCurrency - After comma processing:', cleanValue);
    }
    
    const numValue = parseFloat(cleanValue);
    console.log('üí∞ unmaskCurrency - Parsed number:', numValue);
    
    // Limitar a 2 casas decimais para evitar problemas de precis√£o
    const result = isNaN(numValue) ? 0 : Math.round(numValue * 100) / 100;
    console.log('üí∞ unmaskCurrency - Final result:', result);
    return result;
};
